{% extends 'base.html' %}
{% block title %}Ask a Question{% endblock %}

{% block content %}
      <div class="page-header">
        <h1>Create Your Quiz</h1>
      </div>
      {% if session['quizPart'] == 1 %}
      <div class="row">
        <div class="col-lg-12">
          <div class="well bs-component">
            <form class="form-horizontal" method="POST" action="{{ url_for('main.createQuiz') }}">
              <fieldset>
                <h3>Step 1: General Information</h3>
                <div class="form-group">
                    <label for="grade" class="col-lg-2 control-label">Grade</label>
                    <div class="col-lg-10">
                      <select class="form-control" name="grade" id="grade">
                        <option value="8">Grade 8</option>
                        <option value="9">Grade 9</option>
                      </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="subject" class="col-lg-2 control-label">Subject</label>
                    <div class="col-lg-10">
                      <select class="form-control" name="subject" id="subject">
                        <option value="Geography">Geography</option>
                        <option value="Biology">Biology</option>
                      </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="topic" class="col-lg-2 control-label">Topic</label>
                    <div class="col-lg-10">
                        <input type="text" class="form-control" name="topic" id="topic" placeholder="Topic">
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-lg-10 col-lg-offset-2">
                        <button  type="submit" class="btn btn-primary">Submit</button>
                    </div>
                </div>
                </fieldset>
              </form>
            </div>
          </div>
        </div>
      {%endif%}
      {% if session['quizPart'] == 2 %}
      <div class="row">
        <div class="col-lg-12">
          <div class="well bs-component">
            <form method="post" enctype="multipart/form-data" action="{{ url_for('main.createQuiz') }}">  
              <h2>Step 2: Upload PDF</h2>
              <br>
              <label id="pdf-file-id" for="pdf-file">Choose File</label>
              <span id="file-chosen">No file chosen</span>
              <input type="file" id="pdf-file" name="pdf-file" class="bg-warning" required hidden>
              
              <br>
              <label for="noOfQuestions" class="col-lg-2 control-label">Number Of Questions: </label>
              <input type="number" class="form-control" name="noOfQuestions" id="noOfQuestions">
              <br>
              <label for="easyQuestions" class="col-lg-2 control-label">Percentage of Easy Questions: </label>
              <input type="number"  step=".01" class="form-control" name="easyQuestions" id="easyQuestions">
              <br>
              <label for="mediumQuestions" class="col-lg-2 control-label">Percentage of Medium Questions: </label>
              <input type="number" step=".01" class="form-control" name="mediumQuestions" id="mediumQuestions">
              <br>
              <label for="hardQuestions" class="col-lg-2 control-label">Percentage of Hard Questions: </label>
              <input type="number" step=".01" class="form-control" name="hardQuestions" id="hardQuestions">
              <br>
              <button onclick='updatePreProcess()' type="submit" name="submit" value="UPLOAD" class="btn btn-primary">Upload</button>
              <div id="progress" class="w3-light-grey w3-round-xlarge">
                <div id="progressBarPreProcessing" class="w3-container w3-grey w3-padding w3-round-xlarge" style="width:0%; margin-top:20px;">0%</div>
              </div>
            </form>
            <br><br>
            <!-- <div class="form-group" id="process">
              <div class="progress">
                <div id='progressBarPreProcessing' class="progress-bar progress-bar-striped active bg-success" role="progressbar" aria-valuemin="0" aria-valuemax="100" style="width: 0%"  ></div>
              </div>
            </div> -->
          </div>
        </div>
      </div>
      <script>
        const actualBtn = document.getElementById('pdf-file');

        const fileChosen = document.getElementById('file-chosen');

        actualBtn.addEventListener('change', function(){
          fileChosen.textContent = this.files[0].name
        })
      </script>
      {% endif %}
      {% if session['quizPart'] == 3 %}
      <div class="row">
        <div class="col-lg-12">
          <div class="well bs-component">
            <form method="post" enctype="multipart/form-data" action="{{ url_for('main.createQuiz') }}">  
              <h3>Creation of Questions</h3>
              <br><br>
              <button onclick='updateMLModels()' type="submit" name="submit" class="btn btn-primary">Start ML Models</button>
              <br><br>
              <div id="progress" class="w3-light-grey w3-round-xlarge">
                <div id="progressBarMLModels" class="w3-container w3-grey w3-padding w3-round-xlarge" style="width:0%; margin-top:20px;">0%</div>
              </div>
            </form>
            <br><br>
            <!-- <div class="form-group" id="process">
              <div class="progress">
                <div id='progressBarMLModels' class="progress-bar progress-bar-striped active bg-success" role="progressbar" aria-valuemin="0" aria-valuemax="100" style="width: 0%"  ></div>
              </div>
            </div> -->
          </div>
        </div>
      </div>
      {% endif %}
        <script>
          function updatePreProcess() {
              var element = document.getElementById("progressBarPreProcessing");   
              var width = 1;
              var identity = setInterval(scene, 1500);
              function scene() {
                if (width == 110) {
                    console.log('done')
                    clearInterval(identity);
                } 
                else { 
                  const room_url = {{ url_for('main.getProgressPreProcessing')|tojson}}
                  fetch(room_url)
                      .then(response => response.json())
                      .then(data => {
                        console.log(typeof(width))
                        if(data > width){
                          element.style.width = data + '%'; 
                          element.innerHTML = data + '%';
                          width = data
                        }
                      })
                }
              }
          }

          function updateMLModels() {
              var element = document.getElementById("progressBarMLModels");   
              var width = 1;
              var identity = setInterval(scene, 10000);
              function scene() {
                if (width == 110) {
                    console.log('done')
                    clearInterval(identity);
                } 
                else { 
                  const room_url = {{ url_for('main.getProgressMLModels')|tojson}}
                  fetch(room_url)
                      .then(response => response.json())
                      .then(data => {
                        console.log(typeof(width))
                        if(data > width){
                          element.style.width = data + '%'; 
                          element.innerHTML = data + '%';
                          width = data
                        }
                      })
                }
              }
          }
        </script>
{% endblock %}